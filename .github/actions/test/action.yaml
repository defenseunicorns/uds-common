name: Test
description: Test the UDS package

inputs:
  flavor:
    description: Flavor of the package to test
    required: true
  upgrade:
    description: Whether to run upgrade tests
    default: "false"

runs:
  using: composite
  steps:
    - name: Create test bundle
      run: uds run create-test-bundle --set FLAVOR=${{ inputs.flavor }}
      shell: bash

    - name: Setup cluster
      run: uds run setup-cluster
      shell: bash

    - name: Deploy test bundle
      run: uds run deploy-test-bundle
      shell: bash

    - name: Test package
      run: uds run test-package
      shell: bash

    - name: Test package
      if: ${{ inputs.upgrade }}
      run: uds run test-upgrade --set FLAVOR=${{ inputs.flavor }}
      shell: bash
