includes:
  - utils: https://raw.githubusercontent.com/defenseunicorns/uds-common/4373b8d7dfa16d0d109eeb550e58085b182213e3/tasks/utils.yaml

variables:
  - name: FLAVOR
    default: upstream

tasks:
  - name: package
    description: Publish package for the supplied architecture
    inputs:
      path:
        description: Path to the zarf package being published
        default: .
      version:
        description: The version of the package to publish
        required: true
      architecture:
        description: The architecture of the package to publish
        default: ${UDS_ARCH}
      team:
        description: The team publishing the package
        default: uds
    actions:
      - task: utils:determine-repo
        with:
          team: ${{.inputs.team}}
      - description: Publish package for the supplied architecture
        cmd: |
          ./uds zarf package publish ${{ .inputs.path }}/zarf-package-*-${{ .inputs.architecture }}-${{ .inputs.version }}.tar.zst oci://${TARGET_REPO}

  - name: test-bundle
    description: Publish bundle for the supplied architecture
    inputs:
      path:
        description: Path to the UDS bundle being published
        default: bundle
      version:
        description: The version of the bundle to publish
        required: true
      architecture:
        description: The architecture of the bundle to publish
        default: ${UDS_ARCH}
    actions:
      - task: utils:determine-repo
      - description: Publish bundle for the supplied architecture
        cmd: |
          ./uds publish ${{ .inputs.path }}/uds-bundle-*-${{ .inputs.architecture }}-${{ .inputs.version }}.tar.zst oci://${TARGET_REPO}/bundles --no-progress
