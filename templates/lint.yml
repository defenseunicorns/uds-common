# Copyright 2024 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

spec:
  inputs:
    runs-on:
      default: gitlab-runner-4c-amd64
    run-license-checks:
      default: "false"
    install-dependencies:
      default: "false"

---
lint:
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  script:
    # this is needed for yamllint to be on path
    - export PATH=/home/ubuntu/.local/bin:$PATH

    # Install lint dependencies

    - |
      if [[ "$[[ inputs.install-dependencies ]]" == "true" ]]; then
        uds run lint:deps --no-progress
      fi

    # Lint the repository
    - |
      if [[ "$[[ inputs.run-license-checks ]]" == "false" ]]; then
        LICENSE_OPTS="--set RUN_LICENSE_CHECKS=false"
      fi

      uds run lint:all --no-progress $LICENSE_OPTS
  tags:
    - $[[ inputs.runs-on ]]
