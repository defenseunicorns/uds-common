# Copyright 2024 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

spec:
  inputs:
    runs-on:
      default: gitlab-runner-4c-amd64
    skip-license-checks:
      default: "true"
    skip-dependency-install:
      default: "true"
    skip-compliance-checks:
      default: "true"
---
lint:
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
  script:
    # this is needed for yamllint to be on path
    - export PATH=/home/ubuntu/.local/bin:$PATH

    # Install lint dependencies

    - |
      if [[ "$[[ inputs.skip-dependency-install ]]" == "false" ]]; then  
        uds run lint:deps --no-progress
      fi

    # Lint the repository
    - |
      if [[ "$[[ inputs.skip-license-checks ]]" == "false" ]]; then  
        LICENSE_OPTS="--set SKIP_LICENSE_CHECKS=true" 
      fi

      if [[ "$[[ inputs.skip-compliance-checks ]]" == "false" ]]; then  
        COMPLIANCE_OPTS="--set SKIP_OSCAL=false" 
      fi

      uds run lint:all --no-progress $INSTALL_OPTS $COMPLIANCE_OPTS
  tags:
    - $[[ inputs.runs-on ]]
