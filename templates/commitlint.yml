# Copyright 2024 Defense Unicorns
# SPDX-License-Identifier: AGPL-3.0-or-later OR LicenseRef-Defense-Unicorns-Commercial

spec:
  inputs:
    runs-on:
      default: gitlab-runner-4c-amd64
    install-dependencies:
      default: "false"
---
commitlint:
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event" && $CI_MERGE_REQUEST_TITLE !~ /^Draft/
  script:
    - |
      if [[ "$[[ inputs.install-dependencies ]]" == "true" ]]; then
        npm install --save-dev @commitlint/config-conventional@20.0.0
        npm install --save-dev @commitlint/cli@20.1.0
        echo "module.exports = {extends: ['@commitlint/config-conventional']}" > commitlint.config.js
        echo "$CI_MERGE_REQUEST_TITLE" | npx commitlint
      elif
        echo "$CI_MERGE_REQUEST_TITLE" | npx commitlint
      fi
  tags:
    - $[[ inputs.runs-on ]]
